<mat-spinner *ngIf="isLoading"></mat-spinner>



  <div fxLayout="row warp">
    <div class="search-bar" *ngIf="!isLoading && getMode()" fxFlex="100" style="padding-bottom: 1rem;">
        <ng5-slider [(value)]="sliderMinValue" [(highValue)]="sliderMaxValue" [options]="sliderOptions"></ng5-slider>
        <input mat-input type="text" placeholder="Search auctions..." [(ngModel)]="searchValue">
        <button mat-stroked-button (click)="onPickCategory()" [matMenuTriggerFor]="firstLevelCategories">{{this.searchCategoryName}}</button>
        <mat-menu #firstLevelCategories="matMenu">
        <button
          mat-menu-item
          *ngFor="let category of categories"
          (click)="onSearchCategoryChosen(category._id, category.name)">
          <span style="font-size: 17px;">
            {{category.name}}
          </span>
          </button>
        </mat-menu>
        <button mat-raised-button (click)="onSearchSubmit()" style="margin-left: 5px;">
          <i class="material-icons">
            search
          </i>
        </button>
    </div>

    <mat-drawer-container fxFlex="100" fxLayout="row" style="margin-top:16px;">
        <mat-drawer fxFlex="15" mode="side" opened>
          <h2 class="mat-heading-2"> Shop By Category</h2>
              <button
                  mat-menu-item
                  *ngFor="let category of this.categories"
                  (click)="onCategoryChosen(category._id, category.name)">
                  <span style="font-size: 16px;">
                    {{category.name}}
                  </span>
                </button>
        </mat-drawer>
        <mat-drawer-content fxFlex="85" fxLayout="row">
          <div fxFlex="100" fxLayout="row warp"fxLayoutAlign="center" fxLayoutGap="0.5%" *ngIf="getMode() && !isLoading && recommendations.length > 0">
            <h2>Recommended</h2>
            <mat-card *ngFor="let auction of recommendations" fxLayout="row">
              <div fxFlex="100" fxLayout="row warp">
                  <img fxFlex="100" mat-card-image [title]="auction.name"[src]="auction.image" [alt]="auction.name">
                  <mat-card-footer fxFlex="100">
                      <a
                      mat-button color="primary"
                      [routerLink]="['/auction/', auction.id]">
                        <div>

                            <div>
                              <h4>{{auction.name}}</h4>
                              <p>{{auction.buyPrice}} $</p>
                            </div>
                        </div>
                    </a>
                  </mat-card-footer>
              </div>
            </mat-card>
          </div>

        <div fxFlex="100" fxLayout="row warp" fxLayoutAlign="center" fxLayoutGap="2%" *ngIf="getMode() && !isLoading && auctions.length > 0">
          <div fxFlex="100" style="text-align: center">
              <h2 >Other Items</h2>
          </div>

            <mat-card fxFlex="30" *ngFor="let auction of auctions" fxLayout="row warp">
                        <a fxFlex="100" fxLayout="row warp"
                        mat-button color="primary"
                        [routerLink]="['/auction/', auction.id]">
                        <img fxFlex="100"  mat-card-image [title]="auction.name"[src]="auction.image" [alt]="auction.name">
                        <mat-card-footer fxFlex="100" fxLayout="row warp" fxLayoutAlign="center center">
                                <h4 fxFlex="100">{{auction.name}}</h4>
                                <p fxFlex="100">{{auction.buyPrice}} $</p>
                    </mat-card-footer>
                  </a>
              </mat-card>
          <mat-paginator fxFlex="100"
                         [length]="totalAuctions"
                         [pageSize]="auctionsPerPage"
                         [pageSizeOptions]="pageSizeOptions"
                         (page)="onChangePage($event)">
          </mat-paginator>
        </div>
        <p fxFlex="80" class="info-text mat-body-1" *ngIf="getMode() && auctions.length <= 0 && !isLoading">No auctions found!</p></mat-drawer-content>
      </mat-drawer-container>


    <!-- List all auctions. -->






  <!-- If we need to show just one auction. -->
  <div fxLayout="row warp" *ngIf="!getMode() && !isLoading">
    <div style="margin-top:16px;" *ngIf="username === 'admin'" fxFlex="100" fxLayout="row" fxLayoutAlign = "center center" fxLayoutGap="0.5%">
        <button mat-raised-button color="accent" (click)="onExtract('XML', auction.id)">Extract as XML</button>
        <button mat-raised-button color="accent" (click)="onExtract('JSON', auction.id)">Extract as JSON</button>
    </div>
      <h2 style="text-align: center;"fxFlex="100">{{ auction.name }}</h2>
      <div fxFlex="35">
          <img [src]="this.auction.image" [alt]="this.auction.name">
      </div>
      <div fxFlex="65" style="text-align: center; ">
          <h3>Item's information</h3>
          <p *ngIf="checkBuyPrice(this.auction.buyPrice)">
            Instant buy price: {{ this.auction.buyPrice }}
          </p>
          <p>Auction deadline: {{this.auction.endDate }}</p>
          <p *ngIf="this.categoryNames">Item category: {{this.categoryNames}}</p>
          <p>Country: {{this.auction.country}}</p>
          <p>Address: {{this.auction.address}}</p>
          <p>Highest bid: {{this.auction.highestBid}}</p>
          <p>Description: {{this.auction.description}}</p>
      </div>
      <div fxFlex="100" fxLayout="row warp" fxLayoutAlign="center center" style="text-align: center;">
        <div fxFlex="40">
            <h4>Item's location</h4>
            <agm-map [latitude]="toNumber(this.auction.latitude)" [longitude]="toNumber(this.auction.longitude)">
                  <agm-marker
                    [latitude]="this.auction.latitude"
                    [longitude]="this.auction.longitude">
                  </agm-marker>
          </agm-map>
        </div>
        <div fxFlex="60" >
          <div *ngIf="username!== 'admin'">
            <h4>Bid information</h4>
            <button mat-button *ngIf="this.auction.bids" (click)="onBidList(this.auction)">Show detailed bid information...</button>
            <div class="bid" *ngIf="this.auction.startDate !== null && this.authenticationService.getLoggedUserId()">
                <input type="number" [(ngModel)]="bidValue" placeholder="Bid amount">
                <button
                  mat-raised-button
                  color="warn"
                  (click)="onBidSubmit()">Submit Bid!
                </button>
                <mat-error *ngIf="bidErrorMessage">{{bidErrorMessage}}</mat-error>
            </div>
        </div>
      </div>
      </div>

      <div fxFlex="100">
          <div class="seller" *ngIf="checkOwnership(this.auction.sellerId)">
            <div class="buttons">
              <button
                mat-button
                color="accent"
                (click)="onStart(this.auction.id)"
                *ngIf="this.auction.startDate === null">Start auction
              </button>
              <a
                mat-button color="primary"
                [routerLink]="['/auction/edit', this.auction.id]"
                *ngIf="this.auction.startDate === null">Edit auction</a>
              <button mat-button color="warn" (click)="onDelete(this.auction.id)">Delete auction</button>
            </div>
          </div>
      </div>
  </div>
